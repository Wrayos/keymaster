name: did-npe-1
version: "1.0"
idp:
  - name: nonprod
    type: saml
    config:
      audience: keymaster-saml
      username_attr: name
      email_attr: name
      groups_attr: groups
      redirect_uri: https://workflow.int.btr.place/1/saml/approve
      # Cert may be specified as s3:// file:// or raw data
      certificate: |
        -----BEGIN CERTIFICATE-----
        MIICnTCCAYUCBgFfA+Q72DANBgkqhkiG9w0BAQsFADASMRAwDgYDVQQDDAdjbHVz
        dGVyMB4XDTE3MTAxMDAxMjUxMFoXDTI3MTAxMDAxMjY1MFowEjEQMA4GA1UEAwwH
        Y2x1c3RlcjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMdVYTd1h7fa
        u6/uCgboFyFdoRSWFEHP0Iq9GUWA69g2x+QDqZikSv/JqPwtJBAm+dxdXfOd0RKT
        4ypK09PUNy542kJ+Qwgzwif0ZIEKTYOVS8VvwzZv6BjzwDzSBS/LmdcK8WgRGwgh
        62QgjIYQdGd+wrYN0tOQb6EzINWMs1bq9bFjeFegDG94p/MZ1YWRVXF6h/euq/ym
        gJQc7yvUn5cy6l47tT1ARrCzpUF8Ss4eVhNlLDaz5WSzZ4P1Q+bPe4Iax//zMr/J
        62aqmcf/YuVKIINLa5ML+QFW2B+mR0xky8jwWJiwU5gJzDzLoiNQZ3TJxcfvQaT1
        PuC8ksM9bd0CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAvnrKy75SHGEAIPORf2QC
        NxqWi6Qc/Pl1gHSGHd9nPcIn7u2dRmoq45XWAr55yVZqT/FWshOII504YuFJCQF5
        fyOGKy00jVmaOEIPqyLRA0wf4AsZk607Y2CVZIl1JGwuYx5rHgZ2kf1M4Qxvnhl/
        OUkMrW+VosBgIrqiKWd53Y5TnHaX/q+hYoa/GmRXq0JTJOX+5C11YX9G4rsI7o3c
        MP19yto+e+d5myXu3POAvx4VG07LlWWk3cow2xuiw4zJbZVmK6KO2rMk66WJpfQu
        EmyLmLPjKTmhoskvaHhvSoW6h06Uth3Lf6UHHsAkdzeU+mw0g2Zb2dPlDqz4IV4t
        cg==
        -----END CERTIFICATE-----
roles:
  - name: deployment
    credentials: [kube-admin, aws-admin]
    workflow: deploy_with_approval
    valid_for_seconds: 3600
  - name: deployment-with-credential-wrap
    credentials: [kube-admin, aws-admin]
    workflow: deploy_with_approval
    valid_for_seconds: 3600
    credential_delivery:
      # KMS alias or ARN
      kms_wrap_with: arn:aws:kms:ap-southeast-2:062921715532:key/95a6a059-8281-4280-8500-caf8cc217367
  - name: deployment-with-shared-secret
    credentials: [kube-admin, aws-admin]
    workflow: deploy_with_approval
    valid_for_seconds: 3600
    auth:
      shared_secret: "hunter2"
  - name: deployment-with-jwt-auth
    credentials: [kube-admin, aws-admin]
    workflow: deploy_with_approval
    valid_for_seconds: 3600
    auth:
      jwt:
        require_headers:
          alg: RS256
          kid: f4MyU7qnGmDbcCejhNl38yF-eBYQ7XIzr5v25e9kdhc
        require_claims:
          iss: some.gitlab.instance.com
          project_path: sec/pipeline-test
        verify_with:
          jwks_literal: |
            {"keys":[{"kty":"RSA","kid":"f4MyU7qnGmDbcCejhNl38yF-eBYQ7XIzr5v25e9kdhc","e":"AQAB","n":"xuwNBbJR79sBLWi9y77b9r_voQlUmUZDFymZBFMs364Emht1b7knWr6mBrt_w_nfNhr64gmRuiylUL6iTjUfuoyHK3oYeYE0k89Y9-pU2_KQ4kZbq1ehqi7Y7Ctx3-9j72MQv1yl3q0kKak-JVcp3Mq87ndA7oGB-L6fbNV97kTtR-M_TML5kmr47ETN5yGm75xKnIM2SSczscQ2Furh0W0UREXJOVkqXK53plQ9jqE21pg3Fns7U-jh9SaVQCynx7vFM2zoRAWFXi1W1DdtovWiazjC0Eh3qH9JSDWCc3FH3ejfjqL66iCBMGX1nKaMCsOLOQymhB_ztG74E7s2ZenpcVUOOg7i1ey9Hf5FBRy6xRlLGrkevx4aQQUL7Fpai8WRqCkbLo9yzcVJu8OIg6ZJ9Zq70vOevAHS5hN-22Vr-kJ5Ic7XyZQv-tMIeD-Q8WOypFfNuTy2JH3FPb2sOwqRWF2KgWPBTryb2R0qIO3yJvOutQmZx3GL4rjso6-LwShhPw_UawW2Pi8M2JvQXpT0F7XNB6_rfO5iqPElYBbQiACLrNTZNMBZgXZjsDmTGHEzQwrbdpye1JP3f4KFqYFknc3jzr1al0r3RGZYl5siL_B3CicYQ--Ao65V-yhAfSQ6o9diZrAMSVmkw5H2sRKRBS3ChUGI3wTlHgvY4X8","use":"sig","alg":"RS256"}]}
workflow:
  base_url: https://workflow.int.btr.place/
  policies:
    - name: deploy_with_identify
      identify_roles:
        adfs_role_deployer: 1
    - name: deploy_with_approval
      requester_can_approve: false
      approver_roles:
        gg_digitalid_technical_approver: 1
        gg_digitalid_business_approver: 1
    - name: deploy_with_identify_and_approval
      requester_can_approve: false
      identify_roles:
        adfs_role_deployer: 1
      approver_roles:
        adfs_role_approver: 1
    - name: developer
      identify_roles:
        adfs_role_developer: 1
    - name: cloudengineer
      identify_roles:
        adfs_role_cloudengineer: 1
credentials:
  - name: ssh-jumpbox
    type: ssh_ca
    config:
      # Can be s3:// file:// or raw data
      ca_key: s3://my-bucket/sshca.key
      principals: [$idpuser]
  - name: ssh-all
    type: ssh_ca
    config:
      # Can be s3:// file:// or raw data
      ca_key: s3://my-bucket/sshca.key
      principals: [$idpuser, core, ec2-user]
  - name: kube-user
    type: kubernetes
    config:
      # Can be s3:// file:// or raw data
      ca_key: s3://my-bucket/kubeca.key
  - name: kube-admin
    type: kubernetes
    config:
      # Can be s3:// file:// or raw data
      ca_key: s3://my-bucket/kubeca.key
  - name: aws-ro
    type: iam_assume_role
    config:
      # Can be role ARN or role name, e.g. ARN of ReadOnly
      # role in an account that km can assume-role to.
      target_role: arn:aws:iam::062921715666:role/ReadOnly
  - name: aws-admin
    type: iam_assume_role
    config:
      # Can be role ARN or role name, if only name is given the
      # role will be looked up in the target account.
      target_role: arn:aws:iam::218296299700:role/test_env_admin
access_control:
  ip_oracle:
    whitelist_cidrs: ["192.168.0.0/24", "172.16.0.0/12", "10.0.0.0/8"]
